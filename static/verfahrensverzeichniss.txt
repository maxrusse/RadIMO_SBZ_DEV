============================================================
Verfahrensverzeichnis – RadIMO Cortex (V20)
============================================================

1. Bezeichnung und Beschreibung
------------------------------------------------------------
Verfahrensname / Projekt:
  RadIMO Cortex – Intelligent Radiology Orchestration
  (Version V20)

Beschreibung:
  Plattform zur intelligenten Orchestrierung von Radiologie-
  Teams. Das System automatisiert die Zuweisung von 
  Mitarbeitenden zu Modalitäten (CT, MR, XRAY, Mammo) und 
  subspezialisierten Skills (Notfall, Privat, Herz, MSK, 
  etc.) unter Berücksichtigung von Arbeitslast, 
  Schichtzeiten und individuellen Qualifikationen. 
  Echtzeit-Load-Balancing und eine mehrstufige Fallback-
  Logik gewährleisten eine faire und effiziente 
  Arbeitsverteilung.

2. Verzeichnis der IT-Komponenten
------------------------------------------------------------
Projektverzeichnis:
  c:\Users\Max\code\RadIMO_Cortex (Entwicklung/Lokal)
  /nfs/norasys/notebooks/russe/RadIMO_Cortex (Standard-Produktion)

Wichtige Dateien und Verzeichnisse:
  - app.py                → Haupteinstiegspunkt (Flask)
  - routes.py             → API-Endpunkte und Web-Routen
  - data_manager.py       → Zustandsverwaltung und Datenfluss
  - balancer.py           → Load-Balancing und Zuweisungslogik
  - config.py             → Konfigurations-Loader
  - config.yaml           → Zentrale Systemkonfiguration
  - worker_skill_roster.json → Permanentes Mitarbeiter-Skill-Matrix
  - templates/            → HTML5-UI (Admin-optimiertes Frontend)
  - static/               → CSS, JS, Assets, Verfahrensverzeichnis
  - uploads/              → Medweb CSV-Masterdaten & Backups
  - logs/                 → System- und Zuweisungs-Logs
  - docs/                 → Dokumentation (ADMIN_GUIDE, API, CONFIG)

3. Datenverarbeitung und Backup-Strategie
------------------------------------------------------------
Datenquelle:
  - Medweb CSV-Export (Master CSV) mit Schicht- und Aktivitätsdaten.
  - Das System parst diese Daten täglich automatisiert (07:30 Uhr).

Verarbeitung:
  - Extraktion von Arbeitszeiten und Aktivitäten aus CSV.
  - Mapping auf Modalitäten und Skills via Regex-Regeln.
  - Berücksichtigung von GAPs (Besprechungen, Boards) durch 
    automatisches Schicht-Splitting.
  - Dynamische Gewichtung (Modifiers) je nach Erfahrungsgrad.
  - Skill-basierte Filterung und Load-Balancing zur Vermeidung 
    von Überlastung einzelner Teammitglieder.

Automatisierung:
  - APScheduler für tägliches Preloading und Reset.
  - Echtzeit-Synchronisation bei manuellen Korrekturen über 
    das Admin-Interface (/prep-next-day).

Backup-Strategie:
  - Automatisierte Backups bei jeder kritischen Statusänderung.
  - Aufbewahrung im Verzeichnis uploads/backups/.
  - Integriertes Wiederherstellungssystem für Live-Zustände.

4. Datenarten und personenbezogene Daten
------------------------------------------------------------
Verarbeitete Daten:
  - Name des Mitarbeitenden
  - Benutzerkürzel (Kürzel)
  - Arbeitszeitdaten (Beginn, Ende, Dauer)
  - Tätigkeitsschwerpunkte und Qualifikationen (Skills)
  - Zugehörige Modalitäten (Arbeitsplatz)
  - Arbeitslast-Metriken (Zuweisungszähler, gewichtete Ratios)

Besondere Kategorien:
  - Keine Gesundheitsdaten, keine biometrischen Daten.
  - Ausschließlich dienstbezogene Planungsdaten.

Empfänger:
  - Autorisierte Nutzer (Chefärzte, Oberärzte, Koordinatoren).
  - Zugriff auf Daten beschränkt auf das interne Kliniknetzwerk.

5. Sicherheitsmaßnahmen und Zugriff
------------------------------------------------------------
Technisch:
  - Zwei-Stufen-Zugriffskontrolle:
    1. Basis-Zugang (access_password) für öffentliche Ansichten.
    2. Admin-Zugang (admin_password) für Bearbeitungsfunktionen.
  - Einheitliche Login-Oberfläche (login.html) mit kontextabhängiger 
    Darstellung je nach Zugangsstufe.
  - Session-Management mit kryptografischem Key.
  - Permanente Sessions für Basis-Zugang (365 Tage Cookie-Lebenszeit).
  - Zugriff nur über LAN/VPN möglich (kein öffentliches Routing).
  - Umfangreiches Logging (Audit-Trail) aller Zuweisungs-Aktionen.
  - Thread-sichere Datenhaltung im RAM mit persistenter Sicherung.

Organisatorisch:
  - Trennung zwischen öffentlicher Ansicht und Admin-Editoren.
  - Regelmäßige Bereinigung veralteter Tagesdaten.
  - Dokumentation der Admin-Prozesse (ADMIN_GUIDE.md).

6. Rechtsgrundlage & Löschfristen
------------------------------------------------------------
Rechtsgrundlage:
  - DSGVO Art. 6 Abs. 1 lit. b (Dienstplanung zur Vertragserfüllung).
  - DSGVO Art. 6 Abs. 1 lit. f (Berechtigtes Interesse an 
    effizienter Ressourcensteuerung).

Löschfristen:
  - Live-Daten: Täglicher Reset (07:30 Uhr).
  - Kurzzeit-Backups: Rolling-Cycle (tagesabhängig).
  - System-Logs: 30 Tage Aufbewahrung empfohlen.
  - Master-CSV: Bis zum Import der neuen Monatsdatei.

7. Verantwortlichkeiten
------------------------------------------------------------
Verantwortlich:
  Maximilian Russe
  Institut für Diagnostische und Interventionelle Radiologie

Ansprechpartner:
  - IT-Systemadministration Cortex
  - Beauftragter für Datensicherheit und Datenschutz

8. Versionshistorie
------------------------------------------------------------
V20 (2025-12):
  - Umbenennung in RadIMO Cortex (Intelligent Orchestration).
  - Modularisierung des Backends (routes, balancer, data_manager).
  - Einführung der worker_skill_roster.json für Skill-Persistenz.
  - Erweitertes Load-Balancing (weighted ratios, worker modifiers).
  - Interaktives GAP-Handling und Schicht-Splitting.
  - Neues Admin-Interface (/skill_roster, /prep-next-day).
  - Überarbeitung der Dokumentationsstruktur (Markdown-Docs).

V18 (2025-01):
  - Migration zu medweb CSV-Integration.
  - Basis-Mappingregeln in config.yaml.

9. Technische Details zur Datenverarbeitung
------------------------------------------------------------
Medweb CSV Integration:
  - Einlesen der CSV mit pandas (UTF-8 encoding).
  - Automatisches Mapping von Aktivitäten auf Cortex-Modalitäten 
    und Skills via reguläre Ausdrücke (Regex).
  - Zwei-Phasen-Parsing:
    1. Sammeln aller Schichten und statischen Zeitfenster (Gaps).
    2. Berechnung der effektiven Arbeitsfenster durch Subtraktion 
       der Gaps (Split-Shift-Logik).

Zuweisungslogik (Cortex Balancer):
  - Lastverteilung basierend auf dem Verhältnis von gewichteten 
    Zuweisungen (weighted assignments) zu geleisteten 
    Arbeitsstunden (hours worked).
  - Zwei-Stufen-Fallback (Exklusion -> Skill-basiert).
  - Modale Fallback-Kette: Suche über benachbarte Modalitäten 
    (z.B. X-ray -> CT -> MR) bei Ressourcenknappheit.
  - Berücksichtigung individueller Modifikatoren (Worker Modifiers) 
    für Trainees oder Experten.

10. Datenschutz-Folgenabschätzung
------------------------------------------------------------
Risikobewertung:
  - Minimales Risiko für Betroffene (nur Planungsdaten).
  - Keine automatisierten Einzelfallentscheidungen im Sinne 
    von Art. 22 DSGVO (Algorithmus macht Vorschläge, 
    Endkontrolle durch Menschen).

11. Betroffenenrechte
------------------------------------------------------------
Betroffene haben das Recht auf Auskunft, Berichtigung, 
Löschung und Einschränkung der Verarbeitung ihrer Daten 
gemäß DSGVO Art. 15-21.

Kontakt für Datenschutzanfragen:
  Dr. M. Russe / Systemverantwortlicher.

============================================================
Stand: 2026-01-04
Version: V20
Nächste Überprüfung: 2026-06-01
============================================================
