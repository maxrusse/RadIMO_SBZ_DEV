============================================================
Verfahrensverzeichnis – RadIMO Cortex (V20)
============================================================

1. Bezeichnung und Beschreibung
------------------------------------------------------------
Verfahrensname / Projekt:
  RadIMO Cortex – Intelligent Radiology Orchestration
  (Version V20)

Beschreibung:
  System zur automatisierten, fairen Zuweisung radiologischer
  Mitarbeitender zu Modalitäten (CT, MR, XRAY, Mammo) und
  Skills (z.B. Notfall, Privat, Gyn, MSK/Haut, Card/Thor).
  Die Zuweisung berücksichtigt Schichtzeiten, Skills,
  Arbeitslast sowie konfigurierbare Regeln und Fallbacks.

2. Verzeichnis der IT-Komponenten
------------------------------------------------------------
Projektverzeichnis:
  /workspace/RadIMO_Cortex (Entwicklung/Container)
  /nfs/norasys/notebooks/russe/RadIMO_Cortex (Standard-Produktion)

Wichtige Dateien und Verzeichnisse:
  - app.py                → Haupteinstiegspunkt (Flask)
  - routes.py             → Routen & Authentifizierung
  - balancer.py           → Zuweisungslogik (Load-Balancing)
  - state_manager.py      → Zentraler State & Locking
  - data_manager/         → CSV-Parsing, Persistenz, Scheduler
  - config.yaml           → Zentrale Konfiguration (Skills, Modalitäten, Mapping)
  - worker_skill_roster.json → Permanente Skill-Matrix
  - templates/            → HTML-UI (Admin & Planung)
  - static/               → CSS/JS/Assets, Verfahrensverzeichnis
  - uploads/              → Master-CSV & Backups
  - logs/                 → System-/Zuweisungs- und Usage-Logs
  - docs/                 → ADMIN_GUIDE, API, CONFIG, WORKFLOW

System-Footprint (Richtwerte):
  - CPU: 2–4 vCPU
  - RAM: 2–6 GB
  - Storage: 1–4 GB (ohne CSV-Archivierung)

Software-Stack (requirements.txt):
  - Flask >= 2.3.0
  - pandas >= 2.0.0
  - PyYAML >= 6.0
  - pytz >= 2023.3
  - gunicorn >= 21.2.0
  - APScheduler >= 3.10.0

3. Datenverarbeitung und Backup-Strategie
------------------------------------------------------------
Datenquelle:
  - Medweb-Master-CSV (monatlicher Export), abgelegt als
    uploads/master_medweb.csv.

Verarbeitung (config-gesteuert):
  - Parsing der CSV inkl. Mapping-Regeln (medweb_mapping).
  - Schichtzeiten aus config.yaml.
  - GAP-Handling: Meetings/Boards erzeugen Shift-Splitting.
  - Skill-Matrix (worker_skill_roster.json) überschreibt
    Standardzuordnungen; skill_overrides aus CSV möglich.

Automatisierung:
  - Tages-Reset (daily_reset_time) lädt Live-Daten neu.
  - Auto-Preload (auto_preload_time) bereitet den nächsten
    Arbeitstag für /prep-tomorrow vor.
  - Logik in data_manager/scheduled_tasks.py.

Backup-Strategie:
  - Backups bei kritischen Zustandsänderungen.
  - Ablage in uploads/backups/.
  - Wiederherstellung über integrierte Persistenz.

4. Zuweisungslogik (Kurzüberblick)
------------------------------------------------------------
Grundprinzip:
  - Skill-First-Routing: Spezialisten (skill=1 oder w) zuerst.
  - Generalisten (skill=0) als Overflow-Pool.
  - Exclusions (config.yaml) verhindern unpassende Kombinationen.

Lastberechnung:
  - Gewichtung über Button-Weights (Normal/Strict) und
    Worker-Modifier (global + ggf. w-spezifisch).
  - Vergleich basiert auf gewichteten Zuweisungen pro geleistete
    Arbeitsstunde (global über alle Modalitäten).

Fallbacks:
  - Wenn Spezialisten stark überlastet sind und Overflow erlaubt
    ist, werden Generalisten berücksichtigt (imbalance_threshold_pct).
  - Shift-Buffer kann Overflow am Schichtanfang/-ende blockieren.
  - no_overflow-Regeln erlauben strengere Zuweisung je Skill/Modality.

5. Datenarten und personenbezogene Daten
------------------------------------------------------------
Verarbeitete Daten:
  - Name / Kürzel der Mitarbeitenden
  - Arbeitszeiten (Beginn, Ende, Dauer)
  - Skills/Qualifikationen (Matrix + Overrides)
  - Zugeordnete Modalitäten
  - Zuweisungszähler und gewichtete Metriken
  - Nutzungsstatistik (Skill × Modality Klicks)

Besondere Kategorien:
  - Keine Gesundheitsdaten, keine biometrischen Daten.
  - Es handelt sich um dienstbezogene Planungsdaten.

Empfänger:
  - Autorisierte Nutzer (Chefärzte, Oberärzte, Koordinatoren, MTRA, Ärzte).
  - Zugriff beschränkt auf internes Kliniknetz/VPN.

6. Sicherheitsmaßnahmen und Zugriff
------------------------------------------------------------
Technisch:
  - Zwei-Stufen-Zugriff (konfigurierbar):
    1. Basis-Zugang: access_password (access_protection_enabled)
    2. Admin-Zugang: admin_password (admin_access_protection_enabled)
  - Login über /access-login bzw. /login.
  - Session-Management mit kryptografischem Key.
  - Zugriff nur über LAN/VPN (kein öffentliches Routing).
  - Logging/Audit-Trail in logs/.

Organisatorisch:
  - Trennung von operativer Ansicht und Admin-Bearbeitung.
  - Regelmäßige Bereinigung von Tagesdaten durch Reset.
  - Dokumentierte Admin-Prozesse (docs/ADMIN_GUIDE.md).

7. Rechtsgrundlage & Löschfristen
------------------------------------------------------------
Rechtsgrundlage:
  - DSGVO Art. 6 Abs. 1 lit. b (Dienstplanung zur Vertragserfüllung).
  - DSGVO Art. 6 Abs. 1 lit. f (Berechtigtes Interesse an
    effizienter Ressourcensteuerung).

Löschfristen (Empfehlung):
  - Live-Daten: täglicher Reset.
  - Backups: rolling cycle (tagesabhängig).
  - Zuweisungs-/Usage-Logs: 30 Tage.
  - Master-CSV: bis zur Ablösung durch den nächsten Monatsimport.

8. Verantwortlichkeiten
------------------------------------------------------------
Verantwortlich:
  Maximilian Russe
  Institut für Diagnostische und Interventionelle Radiologie

Ansprechpartner:
  - IT-Systemadministration Cortex
  - Beauftragter für Datensicherheit und Datenschutz

9. Versionshistorie
------------------------------------------------------------
V20 (2026-01):
  - Umbenennung in RadIMO Cortex (Intelligent Orchestration).
  - Modularisierung Backend (routes, balancer, data_manager).
  - Einführung der worker_skill_roster.json.
  - Erweiterte Load-Balancing-Logik und GAP-Handling.
  - Admin-UI für Skill Matrix und Schedule Edit.

V19 (2025-11):
  - Migration zur Medweb-CSV-Integration.
  - Basis-Mappingregeln in config.yaml.

10. Datenschutz-Folgenabschätzung
------------------------------------------------------------
Risikobewertung:
  - Minimales Risiko (nur Planungsdaten).
  - Keine automatisierten Einzelfallentscheidungen i.S.d. Art. 22 DSGVO
    (Algorithmus macht Vorschläge; Endkontrolle durch Menschen).

11. Betroffenenrechte
------------------------------------------------------------
Betroffene Mitarbeitende haben das Recht auf Auskunft,
Berichtigung, Löschung und Einschränkung der Verarbeitung
nach Art. 15–21 DSGVO. 

Kontakt für Datenschutzanfragen:
  Dr. M. Russe / Systemverantwortlicher.

============================================================
Stand: 2026-01-27
Version: V20
Nächste Überprüfung: 2027-01-27
============================================================
