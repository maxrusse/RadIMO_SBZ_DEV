admin_password: change_pw_for_live
modalities:
  ct:
    label: CT
    nav_color: '#1a5276'
    hover_color: '#153f5b'
    background_color: '#e6f2fa'
    factor: 1.0
  mr:
    label: MR
    nav_color: '#777777'
    hover_color: '#555555'
    background_color: '#f9f9f9'
    factor: 1.2
  xray:
    label: X-ray
    nav_color: '#239b56'
    hover_color: '#1d7a48'
    background_color: '#e0f2e9'
    factor: 0.33
  mammo:
    label: Mammo
    nav_color: '#e91e63'
    hover_color: '#c2185b'
    background_color: '#fce4ec'
    factor: 0.5
    # Visibility filters (both optional, can combine):
    # - valid_skills: positive filter - only show these skills
    # - hidden_skills: negative filter - hide these skills
    valid_skills: [Notfall, Privat, Gyn]
    # hidden_skills: [MSK, Chest]  # Example: hide specific skills
modality_fallbacks:
  xray:
    - - ct
      - mr
  ct:
    - mr
  mr: []
  mammo: []
skills:
  Notfall:
    label: Notfall
    button_color: '#dc3545'
    text_color: '#ffffff'
    weight: 1.1
    optional: false
    special: false

    display_order: 0
    slug: notfall
    form_key: notfall
  Privat:
    label: Privat
    button_color: '#ffc107'
    text_color: '#333333'
    weight: 1.2
    optional: true
    special: false

    display_order: 1
    slug: privat
    form_key: privat
  Gyn:
    label: Gyn
    button_color: '#e91e63'
    text_color: '#ffffff'
    weight: 1.0
    optional: true
    special: true
    # Skill-level visibility filters (both optional, can combine):
    # valid_modalities: [mammo, mr]  # only show in these modalities
    # hidden_modalities: [xray]      # or hide in these modalities
    display_order: 2
    slug: gyn
    form_key: gyn
  Päd:
    label: Päd
    button_color: '#4caf50'
    text_color: '#ffffff'
    weight: 1.0
    optional: true
    special: true

    display_order: 3
    slug: paed
    form_key: paed
  MSK:
    label: MSK
    button_color: '#9c27b0'
    text_color: '#ffffff'
    weight: 0.8
    optional: true
    special: true

    display_order: 4
    slug: msk
    form_key: msk
  Abdomen:
    label: Abdomen
    button_color: '#00bcd4'
    text_color: '#ffffff'
    weight: 1.0
    optional: true
    special: true

    display_order: 5
    slug: abdomen
    form_key: abdomen
  Chest:
    label: Chest
    button_color: '#ff9800'
    text_color: '#ffffff'
    weight: 0.8
    optional: true
    special: true

    display_order: 6
    slug: chest
    form_key: chest
  Cardvask:
    label: Cardvask
    button_color: '#28a745'
    text_color: '#ffffff'
    weight: 1.2
    optional: true
    special: true

    display_order: 7
    slug: cardvask
    form_key: cardvask
  Uro:
    label: Uro
    button_color: '#795548'
    text_color: '#ffffff'
    weight: 1.0
    optional: true
    special: true

    display_order: 8
    slug: uro
    form_key: uro

# Skill×Modality weight overrides (Optional)
# Use this to override the default skill_weight × modality_factor calculation
# for specific combinations. If not specified, falls back to: skill.weight × modality.factor
# Example: MR×Herz override instead of 1.2×1.2=1.44
skill_modality_overrides:
  # Example: MR×Cardvask override (instead of default 1.2×1.2=1.44)
  mr:
    Cardvask: 1.8    # Cardiac work in MR weighted higher
  # ct:
  #   Chest: 1.0     # Override CT×Chest

# Skill dashboard behavior
skill_dashboard:
  hide_invalid_combinations: false

# Skill value display colors (for prep page table)
# These define how skill values 1, 0, -1, and 'w' are displayed
skill_value_colors:
  active:     # skill = 1 (primary assignment)
    color: '#28a745'
    label: 'Active'
  passive:    # skill = 0 (fallback only)
    color: '#6c757d'
    label: 'Passive'
  excluded:   # skill = -1 (never assign)
    color: '#dc3545'
    label: 'Excluded'
  weighted:   # skill = 'w' (assisted/weighted)
    color: '#17a2b8'
    label: 'Weighted'

# UI theme colors (for today/tomorrow tabs, success/error messages)
ui_colors:
  today_tab: '#28a745'        # Green for "Change Today"
  tomorrow_tab: '#ffc107'     # Yellow for "Prep Tomorrow"
  success: '#28a745'
  error: '#dc3545'
  warning: '#ffc107'
  info: '#17a2b8'

# Background job and daily reset timings
scheduler:
  daily_reset_time: "07:30"   # Time to move staged tomorrow -> live today
  auto_preload_time: 14       # Hour (0-23) to preload next workday from Master CSV

balancer:
  enabled: true
  min_assignments_per_skill: 5
  imbalance_threshold_pct: 30
  allow_fallback_on_imbalance: true
  modifier_applies_to_active_only: true  # If true, Modifier only applies when skill=1 (active), not skill=0 (fallback)
  disable_overflow_at_shift_end_minutes: 30  # Don't assign overflow work in last X minutes of shift (0 = disabled)

  # Hours counting for load balancing
  # Controls which entries count towards a worker's total hours in workload calculations
  # Default behavior: shifts count, gaps don't count
  # Override per-rule in medweb_mapping using "counts_for_hours: true/false"
  hours_counting:
    shift_default: true   # type: "shift" entries count towards hours (default)
    gap_default: false    # type: "gap" entries don't count towards hours (default)

  # Exclusion-based routing configuration
  exclusion_rules:
    # Define which workers to EXCLUDE when requesting each skill
    # Workers with excluded_skill=1 won't receive work for this skill
    # Two-level fallback: (1) All except exclusions → (2) Skill>=0 → (3) None

    Notfall:
      exclude_skills: []  # No exclusions - anyone can get Notfall work

    Privat:
      exclude_skills: []  # No exclusions - anyone can get Privat work

    Gyn:
      exclude_skills: []

    Päd:
      exclude_skills: []

    MSK:
      exclude_skills: []

    Abdomen:
      exclude_skills: []

    Chest:
      exclude_skills: []

    Cardvask:
      exclude_skills: []

    Uro:
      exclude_skills: []

# Medweb CSV Upload Configuration
# Two types of entries:
#   - type: "shift" (default) = Actual work assignments with modality, skills, times
#   - type: "gap"   = Time exclusions (boards, meetings) - worker unavailable, shows -1 everywhere
#
# Load balancing hours counting:
#   Each rule can have "counts_for_hours: true/false" to control if this entry's
#   hours count towards the worker's total workload for load balancing calculations.
#   - Shifts default to counting (shift_default in balancer.hours_counting)
#   - Gaps default to NOT counting (gap_default in balancer.hours_counting)
#   - Use explicit "counts_for_hours: false" on a shift to exclude from hours calculation
#   - Use explicit "counts_for_hours: true" on a gap to include in hours calculation
# Vendor-specific CSV Upload Configurations
vendor_mappings:
  medweb:
    # Column name mappings for this vendor
    columns:
      date: "Datum"
      activity: "Beschreibung der Aktivität"
      employee_name: "Name des Mitarbeiters"
      employee_code: "Code des Mitarbeiters"
      day_part: "Tageszeit"  # Optional: VM/NM split heuristic

    # Rules for mapping activities to modalities and skills
    # Rules are evaluated in order; first match wins
    rules:
    # ===========================================
    # SHIFTS/ROLES - Actual work assignments
    # ===========================================

    # CT activities - skills come from worker_skill_roster
    - match: "CT Spätdienst"
      type: "shift"
      modality: "ct"
      shift: "Spaetdienst"

    - match: "CT Assistent"
      type: "shift"
      modality: "ct"
      shift: "Fruehdienst"

    - match: "Cortex: CT Privatpatienten"
      type: "shift"
      modality: "ct"
      shift: "Fruehdienst"

    # MR activities - skills come from worker_skill_roster
    - match: "MRT Spätdienst"
      type: "shift"
      modality: "mr"
      shift: "Spaetdienst"

    - match: "MR Assistent 1. Monat"
      type: "shift"
      modality: "mr"
      shift: "Fruehdienst"

    - match: "MR Assistent"
      type: "shift"
      modality: "mr"
      shift: "Fruehdienst"

    - match: "Cortex: MRT-OA"
      type: "shift"
      modality: "mr"
      shift: "Fruehdienst"

    # X-ray activities - skills come from worker_skill_roster
    - match: "Chir Assistent"
      type: "shift"
      modality: "xray"
      shift: "Fruehdienst"

    - match: "OA / FA Chir"
      type: "shift"
      modality: "xray"
      shift: "Fruehdienst"

    # Mammo activities - skills come from worker_skill_roster
    - match: "Mammo Assistent"
      type: "shift"
      modality: "mammo"
      shift: "Fruehdienst"

    - match: "Mammo OA"
      type: "shift"
      modality: "mammo"
      shift: "Fruehdienst"

    # ===========================================
    # TEAMS - Sub-specialty work (multi-modality)
    # skill_overrides override specific Skill_Modality combinations from worker_skill_roster
    # Use this to restrict someone to specific work TODAY, even if they can do more
    # Only specified combinations are overridden; others remain from roster
    # Roster -1 (hard exclude) always wins
    # ===========================================

    - match: "MSK Assistent"
      type: "shift"
      modalities: ["xray", "ct", "mr"]
      shift: "Fruehdienst"
      skill_overrides:
        "MSK_ct": 1
        "MSK_mr": 1
        "MSK_xray": 1

    - match: "MSK Team"
      type: "shift"
      modalities: ["xray", "ct", "mr"]
      shift: "Fruehdienst"
      skill_overrides:
        "MSK_ct": 1
        "MSK_mr": 1
        "MSK_xray": 1

    # Weighted entries: Modifier controls workload factor for beginners
    # Modifier range: 0.5, 0.75, 1.0, 1.25, 1.5 (lower = less capacity, counts more toward load)
    - match: "MSK Anfänger"
      type: "shift"
      modalities: ["xray", "ct"]
      shift: "Fruehdienst"
      modifier: 0.5  # Freshman: assignments count double toward their load
      skill_overrides:
        "MSK_ct": w
        "MSK_xray": w

    - match: "CT Anfänger"
      type: "shift"
      modality: "ct"
      shift: "Fruehdienst"
      modifier: 0.5  # Freshman: assignments count double
      skill_overrides:
        "Notfall_ct": w

    - match: "Cardvask Team"
      type: "shift"
      modalities: ["ct", "mr"]
      shift: "Fruehdienst"
      skill_overrides:
        "Cardvask_ct": 1
        "Cardvask_mr": 1

    - match: "Chest Team"
      type: "shift"
      modalities: ["xray", "ct"]
      shift: "Fruehdienst"
      skill_overrides:
        "Chest_ct": 1
        "Chest_xray": 1

    - match: "Abdomen Team"
      type: "shift"
      modalities: ["ct", "mr"]
      shift: "Fruehdienst"
      skill_overrides:
        "Abdomen_ct": 1
        "Abdomen_mr": 1

    - match: "Uro Team"
      type: "shift"
      modalities: ["ct", "mr"]
      shift: "Fruehdienst"
      skill_overrides:
        "Uro_ct": 1
        "Uro_mr": 1

    - match: "Gyn Team"
      type: "shift"
      modalities: ["ct", "mr"]
      shift: "Fruehdienst"
      skill_overrides:
        "Gyn_ct": 1
        "Gyn_mr": 1

    - match: "Päd Team"
      type: "shift"
      modalities: ["xray", "ct", "mr"]
      shift: "Fruehdienst"
      skill_overrides:
        "Päd_ct": 1
        "Päd_mr": 1
        "Päd_xray": 1

    # Cortex Aufklärung - shift (not a gap) but hours don't count for load balancing
    # No skills needed for this administrative task
    - match: "Cortex Aufklärung"
      type: "shift"
      modality: "ct"
      shift: "Fruehdienst"
      label: "Aufklärung"
      counts_for_hours: false  # Don't count hours towards workload (task, not actual shift)

    # ===========================================
    # GAPS/TASKS - Time exclusions (shows -1 everywhere)
    # Worker unavailable during these times (boards, meetings, teaching)
    # Gaps block only the scheduled window; no pre/post buffers are used.
    # Schedule is day-specific (Montag, Dienstag, Mittwoch, Donnerstag, Freitag)
    # ===========================================

    - match: "Kopf-Hals-Board"
      type: "gap"
      exclusion: true
      schedule:
        Montag: "15:30-17:00"

    - match: "Board"
      type: "gap"
      exclusion: true
      schedule:
        Dienstag: "15:00-17:00"
        Mittwoch: "10:00-12:00"
        Donnerstag: "14:00-16:00"

    - match: "Besprechung"
      type: "gap"
      exclusion: true
      schedule:
        Montag: "09:00-10:00"
        Mittwoch: "14:00-15:00"
        Freitag: "13:00-14:00"

    - match: "Fortbildung"
      type: "gap"
      exclusion: true
      schedule:
        Donnerstag: "13:00-15:00"

    - match: "Aufklärung"
      type: "gap"
      exclusion: true
      schedule:
        Dienstag: "10:00-11:00"
        Donnerstag: "10:00-11:00"

# Shift time definitions
shift_times:
  Fruehdienst:
    default: "07:00-15:00"
    friday: "07:00-13:00"
  Spaetdienst:
    default: "13:00-21:00"
    friday: "13:00-19:00"

# Worker skill roster - Skill×Modality combinations (flat structure)
# Format: "skill_modality": value (or "modality_skill" - both accepted)
# Values: 1 = active, 0 = passive/fallback, -1 = hard exclude (cannot be overridden), w = weighted/assisted
# CSV rules can override specific combinations with skill_overrides
worker_skill_roster:
  # Example: MSK specialist across multiple modalities
  AA:
    "MSK_ct": 1
    "MSK_mr": 1
    "MSK_xray": 1
    "MSK_mammo": 0
    "Notfall_ct": 1
    "Notfall_mr": 1
    "Notfall_xray": 1
    "Notfall_mammo": 0
    "Privat_ct": 0
    "Privat_mr": 0
    "Privat_xray": 0
    "Privat_mammo": 0
    "Gyn_ct": 0
    "Gyn_mr": 0
    "Gyn_xray": 0
    "Gyn_mammo": 0
    "Päd_ct": 0
    "Päd_mr": 0
    "Päd_xray": 0
    "Päd_mammo": 0
    "Abdomen_ct": 0
    "Abdomen_mr": 0
    "Abdomen_xray": 0
    "Abdomen_mammo": 0
    "Chest_ct": 0
    "Chest_mr": 0
    "Chest_xray": 0
    "Chest_mammo": 0
    "Cardvask_ct": 0
    "Cardvask_mr": 0
    "Cardvask_xray": 0
    "Cardvask_mammo": 0
    "Uro_ct": 0
    "Uro_mr": 0
    "Uro_xray": 0
    "Uro_mammo": 0

  # Example: Chest specialist with CT Notfall as fallback only
  AN:
    "Chest_ct": 1
    "Chest_mr": 1
    "Chest_xray": 1
    "Chest_mammo": 0
    "Notfall_ct": 0      # Fallback only for CT
    "Notfall_mr": 1
    "Notfall_xray": 1
    "Notfall_mammo": 0
    "Privat_ct": 0
    "Privat_mr": 0
    "Privat_xray": 0
    "Privat_mammo": 0
    "MSK_ct": 0
    "MSK_mr": 0
    "MSK_xray": 0
    "MSK_mammo": 0
    "Gyn_ct": 0
    "Gyn_mr": 0
    "Gyn_xray": 0
    "Gyn_mammo": 0
    "Päd_ct": 0
    "Päd_mr": 0
    "Päd_xray": 0
    "Päd_mammo": 0
    "Abdomen_ct": 0
    "Abdomen_mr": 0
    "Abdomen_xray": 0
    "Abdomen_mammo": 0
    "Cardvask_ct": 0
    "Cardvask_mr": 0
    "Cardvask_xray": 0
    "Cardvask_mammo": 0
    "Uro_ct": 0
    "Uro_mr": 0
    "Uro_xray": 0
    "Uro_mammo": 0

  # Example: Cardiac specialist, excluded from MSK/Chest (hard exclude with -1)
  DEMO1:
    "Cardvask_ct": 1
    "Cardvask_mr": 1
    "Cardvask_xray": 0
    "Cardvask_mammo": 0
    "Notfall_ct": 1
    "Notfall_mr": 1
    "Notfall_xray": 1
    "Notfall_mammo": 0
    "MSK_ct": -1         # Hard exclude - cannot be overridden
    "MSK_mr": -1
    "MSK_xray": -1
    "MSK_mammo": -1
    "Chest_ct": -1       # Hard exclude
    "Chest_mr": -1
    "Chest_xray": -1
    "Chest_mammo": -1
    "Privat_ct": 0
    "Privat_mr": 0
    "Privat_xray": 0
    "Privat_mammo": 0
    "Gyn_ct": 0
    "Gyn_mr": 0
    "Gyn_xray": 0
    "Gyn_mammo": 0
    "Päd_ct": 0
    "Päd_mr": 0
    "Päd_xray": 0
    "Päd_mammo": 0
    "Abdomen_ct": 0
    "Abdomen_mr": 0
    "Abdomen_xray": 0
    "Abdomen_mammo": 0
    "Uro_ct": 0
    "Uro_mr": 0
    "Uro_xray": 0
    "Uro_mammo": 0

  # Example: MSK junior with weighted proficiency
  MSK_ANFAENGER:
    "MSK_ct": w          # Weighted/assisted - still learning
    "MSK_mr": 0
    "MSK_xray": w
    "MSK_mammo": 0
    "Notfall_ct": 0
    "Notfall_mr": 0
    "Notfall_xray": 0
    "Notfall_mammo": 0
    "Privat_ct": 0
    "Privat_mr": 0
    "Privat_xray": 0
    "Privat_mammo": 0
    "Gyn_ct": 0
    "Gyn_mr": 0
    "Gyn_xray": 0
    "Gyn_mammo": 0
    "Päd_ct": 0
    "Päd_mr": 0
    "Päd_xray": 0
    "Päd_mammo": 0
    "Abdomen_ct": 0
    "Abdomen_mr": 0
    "Abdomen_xray": 0
    "Abdomen_mammo": 0
    "Chest_ct": 0
    "Chest_mr": 0
    "Chest_xray": 0
    "Chest_mammo": 0
    "Cardvask_ct": 0
    "Cardvask_mr": 0
    "Cardvask_xray": 0
    "Cardvask_mammo": 0
    "Uro_ct": 0
    "Uro_mr": 0
    "Uro_xray": 0
    "Uro_mammo": 0
