admin_password: change_pw_for_live

# Basic access protection for non-admin pages (optional)
# Set to false to disable password protection entirely
access_protection_enabled: true
access_password: change_easy_pw

modalities:
  ct:
    label: CT
    nav_color: '#1a5276'
    hover_color: '#153f5b'
    background_color: '#e6f2fa'
    factor: 1.0
  mr:
    label: MR
    nav_color: '#777777'
    hover_color: '#555555'
    background_color: '#f9f9f9'
    factor: 1.2
  xray:
    label: X-ray
    nav_color: '#239b56'
    hover_color: '#1d7a48'
    background_color: '#e0f2e9'
    factor: 0.33
  mammo:
    label: Mammo
    nav_color: '#e91e63'
    hover_color: '#c2185b'
    background_color: '#fce4ec'
    factor: 0.5
    # Visibility filters (both optional, can combine):
    # - valid_skills: positive filter - only show these skills
    # - hidden_skills: negative filter - hide these skills
    valid_skills: [Notfall, Privat, Gyn]
    # hidden_skills: [MSK, Chest]  # Example: hide specific skills

skills:
  Notfall:
    label: Notfall
    button_color: '#dc3545'
    text_color: '#ffffff'
    weight: 1.1
    optional: false
    special: false

    display_order: 0
    slug: notfall
    form_key: notfall
  Privat:
    label: Privat
    button_color: '#ffc107'
    text_color: '#333333'
    weight: 1.2
    optional: true
    special: false

    display_order: 1
    slug: privat
    form_key: privat
  Gyn:
    label: Gyn
    button_color: '#e91e63'
    text_color: '#ffffff'
    weight: 1.0
    optional: true
    special: true
    # Skill-level visibility filters (both optional, can combine):
    # valid_modalities: [mammo, mr]  # only show in these modalities
    # hidden_modalities: [xray]      # or hide in these modalities
    display_order: 2
    slug: gyn
    form_key: gyn
  Päd:
    label: Päd
    button_color: '#4caf50'
    text_color: '#ffffff'
    weight: 1.0
    optional: true
    special: true

    display_order: 3
    slug: paed
    form_key: paed
  MSK:
    label: MSK
    button_color: '#9c27b0'
    text_color: '#ffffff'
    weight: 0.8
    optional: true
    special: true

    display_order: 4
    slug: msk
    form_key: msk
  Abdomen:
    label: Abdomen
    button_color: '#00bcd4'
    text_color: '#ffffff'
    weight: 1.0
    optional: true
    special: true

    display_order: 5
    slug: abdomen
    form_key: abdomen
  Chest:
    label: Chest
    button_color: '#ff9800'
    text_color: '#ffffff'
    weight: 0.8
    optional: true
    special: true

    display_order: 6
    slug: chest
    form_key: chest
  Cardvask:
    label: Cardvask
    button_color: '#28a745'
    text_color: '#ffffff'
    weight: 1.2
    optional: true
    special: true

    display_order: 7
    slug: cardvask
    form_key: cardvask
  Uro:
    label: Uro
    button_color: '#795548'
    text_color: '#ffffff'
    weight: 1.0
    optional: true
    special: true

    display_order: 8
    slug: uro
    form_key: uro

# Skill×Modality weight overrides (Optional)
# Use this to override the default skill_weight × modality_factor calculation
# for specific combinations. If not specified, falls back to: skill.weight × modality.factor
# Example: MR×Herz override instead of 1.2×1.2=1.44
skill_modality_overrides:
  # Example: MR×Cardvask override (instead of default 1.2×1.2=1.44)
  mr:
    Cardvask: 1.8    # Cardiac work in MR weighted higher
  # ct:
  #   Chest: 1.0     # Override CT×Chest

# Skill dashboard behavior
skill_dashboard:
  hide_invalid_combinations: false

# Skill value display colors (for prep page table)
# These define how skill values 1, 0, -1, and 'w' are displayed
skill_value_colors:
  active:     # skill = 1 (primary assignment)
    color: '#28a745'
    label: 'Active'
  passive:    # skill = 0 (fallback only)
    color: '#6c757d'
    label: 'Passive'
  excluded:   # skill = -1 (never assign)
    color: '#dc3545'
    label: 'Excluded'
  weighted:   # skill = 'w' (assisted/weighted)
    color: '#17a2b8'
    label: 'Weighted'

# UI theme colors (for today/tomorrow tabs, success/error messages)
ui_colors:
  today_tab: '#28a745'        # Green for "Change Today"
  tomorrow_tab: '#ffc107'     # Yellow for "Prep Tomorrow"
  success: '#28a745'
  error: '#dc3545'
  warning: '#ffc107'
  info: '#17a2b8'

# Background job and daily reset timings
scheduler:
  daily_reset_time: "07:30"   # Time to move staged tomorrow -> live today
  auto_preload_time: 14       # Hour (0-23) to preload next workday from Master CSV

balancer:
  enabled: true
  min_assignments_per_skill: 3
  imbalance_threshold_pct: 30
  allow_fallback_on_imbalance: true
  disable_overflow_at_shift_start_minutes: 15  # Don't assign overflow work in first X minutes of shift (0 = disabled, per-shift)
  disable_overflow_at_shift_end_minutes: 30    # Don't assign overflow work in last X minutes of shift (0 = disabled, per-shift)

  # Hours counting for load balancing
  # Controls which entries count towards a worker's total hours in workload calculations
  # Default behavior: shifts count, gaps don't count
  # Override per-rule in medweb_mapping using "counts_for_hours: true/false"
  hours_counting:
    shift_default: true   # type: "shift" entries count towards hours (default)
    gap_default: false    # type: "gap" entries don't count towards hours (default)

  # Exclusion-based routing configuration
  # Define which workers to EXCLUDE when requesting each skill
  # Workers with excluded_skill=1 won't receive work for this skill
  # Two-level fallback: (1) All except exclusions → (2) Skill>=0 → (3) None
  #
  # Format (shortcut style like skill_overrides):
  #   SkillName: []           # No exclusions - anyone can get this work
  #   SkillName: [Skill1]     # Exclude workers with Skill1=1
  #   SkillName: [Skill1, Skill2]  # Exclude workers with Skill1=1 or Skill2=1
  exclusion_rules:
    Notfall: []      # No exclusions - anyone can get Notfall work
    Privat: []       # No exclusions - anyone can get Privat work
    Gyn: []
    Päd: []
    MSK: []
    Abdomen: []
    Chest: []
    Cardvask: []
    Uro: []

# =============================================================================
# MEDWEB CSV MAPPING CONFIGURATION (NEW UNIFIED STRUCTURE)
# =============================================================================
#
# Each rule maps a CSV activity description to either a SHIFT or a GAP.
#
# SHIFT RULES:
#   - match: "Activity Name"           # Substring to match in CSV activity
#     type: "shift"
#     times:                           # REQUIRED: Day-specific times
#       default: "07:00-15:00"         # Default time (Mon-Thu unless overridden)
#       Montag: "08:00-16:00"          # Optional: Monday override
#       Freitag: "07:00-13:00"         # Optional: Friday override
#     skill_overrides:                 # REQUIRED: Defines what skills & modalities
#       Notfall_ct: 1                  # Skill_Modality: value (1, 0, -1, w)
#       Notfall_mr: 1
#       MSK_ct: 0                      # Modalities are DERIVED from keys
#     gaps:                            # OPTIONAL: Embedded gaps for this shift
#       Montag:
#         - "10:00-11:00"              # Multiple gaps per day supported
#         - "14:00-15:00"
#     modifier: 1.0                    # OPTIONAL: Workload modifier (0.5-1.5)
#     counts_for_hours: true           # OPTIONAL: Count in load balancing
#
# GAP RULES (Standalone):
#   - match: "Board"                   # Substring to match
#     type: "gap"
#     schedule:                        # Day-specific times (arrays supported)
#       Montag:
#         - "10:00-11:00"
#         - "14:00-15:00"
#       Dienstag:
#         - "15:00-17:00"
#
# HOW DAY PLANS ARE BUILT:
#   1. Worker has multiple CSV entries → all matching rules are processed
#   2. Multiple shifts → later shift ENDS prior shift (no overlap)
#   3. Multiple gaps → all gaps are subtracted from shifts
#   4. Gaps ALWAYS WIN over shifts
#   5. Standalone gap with no shift → creates "unavailable" entry
#
# =============================================================================

vendor_mappings:
  medweb:
    # Column name mappings for this vendor
    columns:
      date: "Datum"
      activity: "Beschreibung der Aktivität"
      employee_name: "Name des Mitarbeiters"
      employee_code: "Code des Mitarbeiters"
      day_part: "Tageszeit"  # Optional: VM/NM split heuristic

    # Rules for mapping activities to shifts/gaps
    # Rules are evaluated in order; first match wins
    rules:
    # ===========================================
    # SHIFTS - Work assignments with times and skill_overrides
    # ===========================================

    # CT Shifts
    - match: "CT Spätdienst"
      type: "shift"
      times:
        default: "13:00-21:00"
        Freitag: "13:00-19:00"
      skill_overrides:
        Notfall_ct: 1
        Privat_ct: 1
        MSK_ct: 0
        Abdomen_ct: 0
        Chest_ct: 0
        Cardvask_ct: 0
        Uro_ct: 0
        Gyn_ct: 0
        Päd_ct: 0

    - match: "CT Assistent"
      type: "shift"
      times:
        default: "07:00-15:00"
        Freitag: "07:00-13:00"
      skill_overrides:
        Notfall_ct: 1
        Privat_ct: 1
        MSK_ct: 0
        Abdomen_ct: 0
        Chest_ct: 0
        Cardvask_ct: 0
        Uro_ct: 0
        Gyn_ct: 0
        Päd_ct: 0

    - match: "Cortex: CT Privatpatienten"
      type: "shift"
      times:
        default: "07:00-15:00"
        Freitag: "07:00-13:00"
      skill_overrides:
        Privat_ct: 1
        Notfall_ct: 0

    # MR Shifts
    - match: "MRT Spätdienst"
      type: "shift"
      times:
        default: "13:00-21:00"
        Freitag: "13:00-19:00"
      skill_overrides:
        Notfall_mr: 1
        Privat_mr: 1
        MSK_mr: 0
        Abdomen_mr: 0
        Chest_mr: 0
        Cardvask_mr: 0
        Uro_mr: 0
        Gyn_mr: 0
        Päd_mr: 0

    - match: "MR Assistent 1. Monat"
      type: "shift"
      times:
        default: "07:00-15:00"
        Freitag: "07:00-13:00"
      modifier: 0.5  # Beginner: counts double toward their load
      skill_overrides:
        Notfall_mr: w
        Privat_mr: 0

    - match: "MR Assistent"
      type: "shift"
      times:
        default: "07:00-15:00"
        Freitag: "07:00-13:00"
      skill_overrides:
        Notfall_mr: 1
        Privat_mr: 1
        MSK_mr: 0
        Abdomen_mr: 0
        Chest_mr: 0
        Cardvask_mr: 0
        Uro_mr: 0
        Gyn_mr: 0
        Päd_mr: 0

    - match: "Cortex: MRT-OA"
      type: "shift"
      times:
        default: "07:00-15:00"
        Freitag: "07:00-13:00"
      skill_overrides:
        Notfall_mr: 1
        Privat_mr: 1
        MSK_mr: 1
        Abdomen_mr: 1
        Chest_mr: 1
        Cardvask_mr: 1
        Uro_mr: 1
        Gyn_mr: 1
        Päd_mr: 1

    # X-ray Shifts
    - match: "Chir Assistent"
      type: "shift"
      times:
        default: "07:00-15:00"
        Freitag: "07:00-13:00"
      skill_overrides:
        Notfall_xray: 1
        Privat_xray: 1
        MSK_xray: 0
        Chest_xray: 0
        Päd_xray: 0

    - match: "OA / FA Chir"
      type: "shift"
      times:
        default: "07:00-15:00"
        Freitag: "07:00-13:00"
      skill_overrides:
        Notfall_xray: 1
        Privat_xray: 1
        MSK_xray: 1
        Chest_xray: 1
        Päd_xray: 1

    # Mammo Shifts
    - match: "Mammo Assistent"
      type: "shift"
      times:
        default: "07:00-15:00"
        Freitag: "07:00-13:00"
      skill_overrides:
        Notfall_mammo: 1
        Privat_mammo: 1
        Gyn_mammo: 0

    - match: "Mammo OA"
      type: "shift"
      times:
        default: "07:00-15:00"
        Freitag: "07:00-13:00"
      skill_overrides:
        Notfall_mammo: 1
        Privat_mammo: 1
        Gyn_mammo: 1

    # ===========================================
    # TEAM SHIFTS - Multi-modality with specific skills
    # ===========================================

    - match: "MSK Assistent"
      type: "shift"
      times:
        default: "07:00-15:00"
        Freitag: "07:00-13:00"
      skill_overrides:
        MSK_ct: 1
        MSK_mr: 1
        MSK_xray: 1

    - match: "MSK Team"
      type: "shift"
      times:
        default: "07:00-15:00"
        Freitag: "07:00-13:00"
      skill_overrides:
        MSK_ct: 1
        MSK_mr: 1
        MSK_xray: 1
      # Example: Team-specific gaps (optional)
      # gaps:
      #   Montag:
      #     - "14:00-15:00"  # Team meeting

    - match: "MSK Anfänger"
      type: "shift"
      times:
        default: "07:00-15:00"
        Freitag: "07:00-13:00"
      modifier: 0.5  # Beginner: counts double toward their load
      skill_overrides:
        MSK_ct: w
        MSK_xray: w

    - match: "CT Anfänger"
      type: "shift"
      times:
        default: "07:00-15:00"
        Freitag: "07:00-13:00"
      modifier: 0.5  # Beginner: counts double toward their load
      skill_overrides:
        Notfall_ct: w

    - match: "Cardvask Team"
      type: "shift"
      times:
        default: "07:00-15:00"
        Freitag: "07:00-13:00"
      skill_overrides:
        Cardvask_ct: 1
        Cardvask_mr: 1

    - match: "Chest Team"
      type: "shift"
      times:
        default: "07:00-15:00"
        Freitag: "07:00-13:00"
      skill_overrides:
        Chest_ct: 1
        Chest_xray: 1

    - match: "Abdomen Team"
      type: "shift"
      times:
        default: "07:00-15:00"
        Freitag: "07:00-13:00"
      skill_overrides:
        Abdomen_ct: 1
        Abdomen_mr: 1

    - match: "Uro Team"
      type: "shift"
      times:
        default: "07:00-15:00"
        Freitag: "07:00-13:00"
      skill_overrides:
        Uro_ct: 1
        Uro_mr: 1

    - match: "Gyn Team"
      type: "shift"
      times:
        default: "07:00-15:00"
        Freitag: "07:00-13:00"
      skill_overrides:
        Gyn_ct: 1
        Gyn_mr: 1

    - match: "Päd Team"
      type: "shift"
      times:
        default: "07:00-15:00"
        Freitag: "07:00-13:00"
      skill_overrides:
        Päd_ct: 1
        Päd_mr: 1
        Päd_xray: 1

    # Cortex Aufklärung - shift but hours don't count for load balancing
    - match: "Cortex Aufklärung"
      type: "shift"
      times:
        default: "07:00-15:00"
        Freitag: "07:00-13:00"
      label: "Aufklärung"
      counts_for_hours: false  # Administrative task
      skill_overrides:
        Notfall_ct: 0  # Minimal skill, just to have a modality

    # ===========================================
    # GAPS - Time exclusions (worker unavailable)
    # Uses same 'times' field as shifts, with 'skill_overrides: {all: -1}'
    # Times supports multiple time blocks per day (arrays)
    #
    # skill_overrides shortcuts:
    #   all: -1        → all skill_modality combos = -1
    #   MSK: 1         → all MSK_* combos = 1 (MSK_ct, MSK_mr, etc.)
    #   ct: 1          → all *_ct combos = 1 (Notfall_ct, MSK_ct, etc.)
    # ===========================================

    - match: "Kopf-Hals-Board"
      type: "gap"
      times:
        Montag:
          - "15:30-17:00"
      skill_overrides:
        all: -1

    - match: "Board"
      type: "gap"
      times:
        Dienstag:
          - "15:00-17:00"
        Mittwoch:
          - "10:00-12:00"
        Donnerstag:
          - "14:00-16:00"
      skill_overrides:
        all: -1

    - match: "Besprechung"
      type: "gap"
      times:
        Montag:
          - "09:00-10:00"
        Mittwoch:
          - "14:00-15:00"
        Freitag:
          - "13:00-14:00"
      skill_overrides:
        all: -1

    - match: "Fortbildung"
      type: "gap"
      times:
        Donnerstag:
          - "13:00-15:00"
      skill_overrides:
        all: -1

    - match: "Aufklärung"
      type: "gap"
      times:
        Dienstag:
          - "10:00-11:00"
        Donnerstag:
          - "10:00-11:00"
      skill_overrides:
        all: -1

    # ===========================================
    # GENERIC GAP - For manual entries on prep page
    # Empty times = won't auto-match from CSV, only manual selection
    # ===========================================
    - match: "[Gap]"
      type: "gap"
      times: {}
      skill_overrides:
        all: -1
